# üí¨ YouTube-style Video Platform ‚Äî High-Level Design (HLD) with Data Estimations

---

## üìå Functional Requirements

- User registration & authentication (email/phone, OAuth)
- Upload & publish videos (public / unlisted / private / scheduled)
- Video playback (adaptive bitrate / seeking)
- Live streaming (single-host and multi-host)
- Video discovery: search, recommendations, trending, channels, subscriptions
- Comments, likes/dislikes, playlists, watch later, subscriptions
- Content moderation & copyright enforcement (Content ID)
- Monetization: ads insertion, membership, superchat, transactions
- Analytics/dashboard for creators (views, watch time, revenue)
- Multi-device viewing and offline downloads
- Captions / subtitles and multi-language support

---

## ‚öôÔ∏è Non-Functional Requirements

- Extremely high availability & global distribution
- Low startup latency for playback and smooth adaptive streaming
- Cost-efficient storage for petabytes/exabytes of media
- Strong content protection & DRM when required
- Scalable ML systems for recommendations and moderation
- Consistent analytics at massive scale (near-real-time)
- GDPR / COPPA / local regulation compliance

---

## üß† System Components Overview

### 1. **Client Layer**

- Android, iOS, Web, Smart TVs, Game Consoles
- Adaptive player (HLS/DASH), offline cache, prefetching
- Upload client: resumable chunked uploads, local encoding hints
- Local encryption for DRM protected downloads

### 2. **API Gateway**

- Authentication (JWT / OAuth 2.0)
- Rate limiting, feature flags, API versioning
- Edge parsing for device capabilities (bandwidth, display)

### 3. **Microservices (Core Back-End)**

|                 Service | Purpose                                                    |
| ----------------------: | ---------------------------------------------------------- |
|          Upload Service | Chunked/resumable uploads, validation, dedupe checks       |
|      Ingest & Transcode | Transcoding into multiple ABR renditions + thumbnails      |
|         Storage Service | Object lifecycle management, tiering, cold-storage jobs    |
| CDN/Delivery Controller | Origin selection, signed URLs, cache control               |
|        Playback Service | Authenticated manifest generation, DRM license endpoints   |
|  Recommendation Service | Ranking, personalization, A/B experiments                  |
|          Search Service | Indexing metadata, captions, semantic search               |
|       Comments & Social | CRUD for comments, replies, moderation workflow            |
|  Live Streaming Service | Ingest, real-time transcoding, chat, replay                |
|        Monetization/Ads | Ad decisioning, insertion (server & client side), billing  |
|       Analytics Service | Event collection, aggregation, near-real-time insights     |
|  Moderation & ContentID | Hashing, fingerprinting, policy engine, appeals processing |
|    Notification Service | Subscriptions, push/email, scheduled publish alerts        |
|      Creators Dashboard | Creator uploads, metadata, revenue, reports                |

---

## üìä Estimated Data Metrics (Example Assumptions)

> **Scale assumptions** ‚Äî pick numbers you want to defend in an interview; these are representative of a very large service.

### üë• User Base

- Monthly Active Users: **~2.5B**
- Daily Active Users (DAU): **~1B**
- Peak concurrent viewers (all regions): **~50‚Äì100M+** (during global events)

### ‚ñ∂Ô∏è Content & Uploads

- Avg videos uploaded / day: **~500K ‚Äî 2M** (varies by assumption)
- Avg video length: **8‚Äì12 minutes**
- Avg stored video size (after renditions): **~300‚Äì800 MB** (depends on encoding & length)
- Total new video bytes/day (ingest, raw + renditions): **~100‚Äì500 TB/day**

### üì∫ Playback & CDN

- Peak video streams/sec: **~500K ‚Äî 2M** (global)
- Avg watch time per user/day: **~30‚Äì60 minutes**
- CDN cache hit ratio: **~85‚Äì95%** for popular segments
- Egress volume/day: **multiple PBs** (depends on user base & watch time)

### üìà Analytics & Events

- Events generated/user/day (views, seeks, impressions): **~200 tokens**
- Events ingestion rate: **~100K ‚Äî 1M events/sec**

---

## üóÉÔ∏è Storage & Data Strategy

|                Component | Storage Type                       | Example Tech                      |
| -----------------------: | ---------------------------------- | --------------------------------- |
| Raw uploads & renditions | Object Storage (hot/cool/archival) | S3 / GCS with lifecycle rules     |
|     Metadata & user data | Relational / NoSQL                 | Spanner / Cockroach / PostgreSQL  |
|     Video index & search | Search engine                      | Elasticsearch / Vespa / Meili     |
|   Transcode jobs & state | Distributed queue                  | Kafka / PubSub                    |
|     Live chat / presence | In-memory / DB                     | Redis / Cassandra                 |
|           Analytics lake | Columnar / Data lake               | BigQuery / ClickHouse / Snowflake |

**Tiering & lifecycle**

- Hot (recent/popular) on fast object store + CDN
- Warm on cheaper object tier with occasional rehydrate
- Cold/Archive (old/rarely watched) in Glacier/Archive classes

---

## üöÄ Video Ingest ‚Üí Playback Flow

sequenceDiagram
Client->>Upload Service: Start resumable upload (chunked)
Upload Service->>Storage (temp): Store chunks, compute content hash
Upload Service->>Ingest Service: Compose object, validate, dedupe
Ingest Service->>Transcode Cluster: Create ABR renditions + thumbnails + captions
Transcode Cluster->>Storage (objects): Persist renditions + manifests
Ingest Service->>Search & Metadata DB: Index metadata & captions
CDN->>Origin Controller: Cache popular renditions
Client->>Playback Service: Request manifest (DASH/HLS)
Playback Service->>CDN: Issue signed URL / auth token
Client->>CDN: Stream ABR segments, player reports events to Analytics

---

## üõ∞Ô∏è Content Delivery & Playback Optimizations

- **ABR (Adaptive Bitrate)**: Provide multiple renditions (240p ‚Üí 2160p+) with segment durations tuned for latency.
- **Segmented caching**: Cache small segments (2‚Äì6s) for fast quality shifts.
- **Edge computing**: Pre-generate low-latency manifests & ad decisioning at edge PoPs.
- **Signed, time-limited URLs**: Protect paid/region-restricted content.
- **Offline downloads**: Encrypted cached files bound to account/device.

---

## üîê Content Protection & DRM

- DRM license servers (Widevine / PlayReady / FairPlay) for premium content
- Signed manifests + tokenized access for region/subscription gating
- Client attestation for offline playback keys
- Watermarking & forensic marking for premium/partner videos

---

## üß† Recommendations, Search & ML

**Recommendation pipeline**

- Real-time event stream ‚Üí feature generation ‚Üí candidate retrieval (approximate nearest neighbors) ‚Üí re-ranking (DNN + business rules) ‚Üí renderer (diversified feed)
- A/B experiments and online learning to optimize watch time / satisfaction

**Search**

- Index metadata, captions (ASR), tags, transcripts
- Use semantic embeddings + lexical ranking
- Freshness and freshness boosting for trending topics

**Moderation & Safety**

- Automated classifiers (vision, audio, text) + human review
- Strike system, appeals, policy engine
- Spam / bot detection for comments and channels

---

## üß© Live Streaming Specifics

- Ingest via RTMP / WebRTC
- Low-latency transcode pipeline (LL-HLS / CMAF / WebRTC)
- Real-time chat with moderation & superchat monetization
- DVR and replay generation as VOD renditions after stream ends

---

## üõ†Ô∏è Caching Strategy (summary)

|                       Item | Tool                      | TTL / Approach                     |
| -------------------------: | ------------------------- | ---------------------------------- |
|   Popular video renditions | CDN                       | Minutes ‚Üí hours (LRU + popularity) |
|      Channel subscriptions | Redis                     | 1 hour / event invalidation        |
| Thumbnails & static assets | CDN                       | Long TTL + cache busting           |
|    Recent analytics window | Streaming DB / ClickHouse | Sliding window (minutes)           |

---

## üìà Monitoring & Observability

|                         Metric | Tooling                          |
| -----------------------------: | -------------------------------- |
|  Startup latency & rebuffering | Prometheus + Grafana             |
|     CDN hit ratio & cache fill | CDN metrics, internal dashboards |
| Transcode failures & queue lag | ELK / Datadog                    |
|         Ad decisioning latency | OpenTelemetry traces             |
|   ML model drift & A/B metrics | Custom model monitoring, MLflow  |

Alerting for SLO breaches (startup latency, error rate, CDN availability) with automated failover to lower-quality renditions when necessary.

---

## üîÑ Scalability & Availability Patterns

- **Microservices + autoscaling** for web APIs and transcoders (GPU clusters for heavy transcode)
- **CDN + multi-origin** to serve regionally with origin failover
- **Event streaming (Kafka/PubSub)** for decoupling ingestion ‚Üí processing ‚Üí analytics
- **Sharding & partitioning** for hot channels and high-traffic creators
- **Idempotent ingest** (content hashes) to avoid duplicate storage

---

## üîê Compliance, Privacy & Copyright

- Content ID / fingerprinting to detect copyrighted material
- Takedown workflows, DMCA compliance, appeals
- Per-region legal holds, age-restriction logic
- Privacy by design: minimize PII in analytics, allow data export & deletion

---

## üß± Tech Stack Summary (example)

|             Layer | Technologies (examples)                      |
| ----------------: | -------------------------------------------- |
|          Frontend | Kotlin/Swift/React/TV SDKs                   |
|      Ingest / API | Go / Java / Node.js (gRPC/HTTP2)             |
|       Transcoding | FFmpeg on k8s + GPU nodes                    |
|     Storage & CDN | S3/GCS + Cloud CDN / Fastly / Akamai         |
| Streaming / Queue | Kafka / PubSub                               |
|         Databases | Spanner/Cockroach, Cassandra, Redis          |
|    Search & Index | Vespa / Elasticsearch                        |
|    Analytics & BI | ClickHouse / BigQuery                        |
|          ML infra | TensorFlow/PyTorch, Feast, TF Serving/KServe |

---

## üîÑ Design Trade-offs & Challenges

|                             Challenge | Typical Solution / Tradeoff                                  |
| ------------------------------------: | ------------------------------------------------------------ |
|      Storage cost vs playback quality | Tiering + transcode strategy; keep lower bitrates long term  |
|         Low latency vs CDN efficiency | Shorter segments for latency but increased request load      |
| Recommendation fairness vs engagement | Introduce diversification & guardrails (avoid filter bubble) |
|              Content moderation scale | Automate with ML + human review for edge cases               |
|         Live scaling unpredictability | Pre-warmed pools & burstable infra (spot/ondemand)           |
|          Copyright detection accuracy | Fingerprinting + hashed matching + human appeals             |

---

## üìä Final Notes (what to emphasize in an interview)

- Focus on **data flow** (ingest ‚Üí transcode ‚Üí storage ‚Üí CDN ‚Üí client) and how you handle **scale** at each stage.
- Explain how **ABR + CDN** reduce user-perceived latency and egress costs.
- Show awareness of **ML pipelines** for recommendations and moderation and how they connect to event streams.
- Discuss **cost controls** (tiering, dedupe, cold archival) and **SLOs** (startup latency, rebuffer rate).
- Be explicit about **consistency models**: metadata needs strong consistency; video segments can be eventually consistent across regions.
- Always state assumptions when giving numbers ‚Äî interviewers appreciate defensible estimates.
